<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>カルテ入力フォーム（構造化出力）</title>
  <style>
    body {
      font-family: "Noto Sans JP","メイリオ",sans-serif;
      background:#f7f9fb; color:#333;
      padding:20px;
    }
    h2 { border-left:5px solid #4a90e2; padding-left:10px; }
    label { font-weight:bold; margin-top:10px; display:block; }
    textarea, input {
      width:95%; max-width:800px;
      padding:6px; margin:5px 0;
      border:1px solid #ccc; border-radius:4px;
    }
    button {
      background:#4a90e2; color:#fff; border:none;
      padding:8px 14px; margin:10px 5px;
      border-radius:4px; cursor:pointer;
    }
    button:hover { background:#357ABD; }
    pre {
      background:#fff; border:1px solid #ddd; padding:10px;
      white-space:pre-wrap; word-wrap:break-word;
    }
  </style>
</head>
<body>
  <h2>カルテ入力フォーム</h2>

  <label>プロブレム</label>
  <div id="problems">
    <textarea name="problem" rows="2" cols="80"></textarea>
  </div>
  <button type="button" onclick="addProblem()">＋ 行を追加</button>

  <label>主訴</label>
  <textarea id="chief" rows="2"></textarea>

  <label>現病歴</label>
  <textarea id="history" rows="4"></textarea>

  <label>既往歴</label>
  <textarea id="past" rows="2"></textarea>

  <label>常用薬</label>
  <textarea id="meds" rows="2"></textarea>

  <label>アレルギー</label>
  <textarea id="allergy" rows="2"></textarea>

  <label>キーパーソン</label>
  <textarea id="keyperson" rows="2"></textarea>

  <label>入院後経過</label>
  <textarea id="course" rows="4"></textarea>

  <label>プラン</label>
  <textarea id="plan" rows="3"></textarea>

  <button onclick="generateText()">構造化テキストを作成</button>

  <h3>コピーしてカルテに貼り付け</h3>
  <pre id="output"></pre>

  <script>
    // プロブレム欄を追加
    function addProblem(){
      let container = document.getElementById("problems");
      let newField = document.createElement("textarea");
      newField.name = "problem";
      newField.rows = 2;
      newField.cols = 80;
      newField.style.marginTop = "5px";
      container.appendChild(newField);
    }

    // 出力生成
    function generateText(){
      let result = "";

      // プロブレムは横並びで番号付き
      let problems = Array.from(document.getElementsByName("problem"))
                          .map(el => el.value.trim())
                          .filter(v => v !== "");
      if(problems.length){
        result += "[プロブレム] " + problems.map((val, idx) => {
          return "#" + (idx+1) + " " + val;
        }).join(" ") + "\n";
      }

      // その他の項目
      let fields = [
        {id:"chief", label:"[主訴]"},
        {id:"history", label:"[現病歴]"},
        {id:"past", label:"[既往歴]"},
        {id:"meds", label:"[常用薬]"},
        {id:"allergy", label:"[アレルギー]"},
        {id:"keyperson", label:"[キーパーソン]"},
        {id:"course", label:"[入院後経過]"},
        {id:"plan", label:"[プラン]"}
      ];

      fields.forEach(f=>{
        let val = document.getElementById(f.id)?.value.trim();
        if(val) result += f.label + " " + val + "\n";
      });

      document.getElementById("output").textContent = result || "入力なし";
    }
  </script>
</body>
</html>